2022-12-05 16:05:22,570 - SimulatorRunner - INFO - Create the Simulator Server.
2022-12-05 16:05:22,651 - nvflare.fuel.hci.server.hci - INFO - Starting Admin Server localhost on Port 48033
2022-12-05 16:05:22,656 - SimulatorServer - INFO - starting insecure server at localhost:59079
2022-12-05 16:05:22,657 - SimulatorRunner - INFO - Deploy the Apps.
2022-12-05 16:05:28,306 - SimulatorRunner - INFO - Create the simulate clients.
2022-12-05 16:05:28,317 - ClientManager - INFO - Client: New client site-1@[ joined. Sent token: ef0b6c2d-8bfb-4e93-ba94-ee33138fbb2f.  Total clients: 1
2022-12-05 16:05:28,318 - FederatedClient - INFO - Successfully registered client:site-1 for project simulator_server. Token:ef0b6c2d-8bfb-4e93-ba94-ee33138fbb2f SSID:
2022-12-05 16:05:28,324 - ClientManager - INFO - Client: New client site-2@[ joined. Sent token: 0daa4e44-d9ff-48ae-8b54-d176e90d5969.  Total clients: 2
2022-12-05 16:05:28,325 - FederatedClient - INFO - Successfully registered client:site-2 for project simulator_server. Token:0daa4e44-d9ff-48ae-8b54-d176e90d5969 SSID:
2022-12-05 16:05:28,327 - SimulatorRunner - INFO - Set the client status ready.
2022-12-05 16:05:28,327 - SimulatorRunner - INFO - Deploy and start the Server App.
2022-12-05 16:05:30,590 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job]: Server runner starting ...
2022-12-05 16:05:30,592 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job]: starting workflow scatter_and_gather (<class 'nvflare.app_common.workflows.scatter_and_gather.ScatterAndGather'>) ...
2022-12-05 16:05:30,592 - ScatterAndGather - INFO - [identity=simulator_server, run=simulate_job]: Initializing ScatterAndGather workflow.
2022-12-05 16:05:30,598 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job]: Workflow scatter_and_gather (<class 'nvflare.app_common.workflows.scatter_and_gather.ScatterAndGather'>) started
2022-12-05 16:05:30,599 - ScatterAndGather - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather]: Beginning ScatterAndGather training phase.
2022-12-05 16:05:30,600 - ScatterAndGather - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather]: Round 0 started.
2022-12-05 16:05:30,600 - ScatterAndGather - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather]: scheduled task train
2022-12-05 16:05:31,359 - SimulatorClientRunner - INFO - Start the clients run simulation.
2022-12-05 16:05:31,360 - SimulatorClientRunner - INFO - Start the clients run simulation.
2022-12-05 16:05:32,361 - SimulatorClientRunner - INFO - Simulate Run client: site-1
2022-12-05 16:05:32,381 - SimulatorClientRunner - INFO - Simulate Run client: site-2
-------------------------------------------------- initialize: site-2 --------------------------------------------------

            load data from /workspace/src/data: site-2_train.csv and site-2_val.csv
            size of the data: 
            site-2_train.csv: 15347
            site-2_val.csv: 1919
            
2022-12-05 16:05:48,105 - ClientRunner - INFO - [identity=site-2, run=simulate_job]: client runner started
2022-12-05 16:05:48,105 - ClientTaskWorker - INFO - Initialize ClientRunner for client: site-2
2022-12-05 16:05:48,114 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather, peer=site-2, peer_run=simulate_job, task_name=train, task_id=a8fd8b19-8ab7-45a2-97ae-8357d78e491a]: assigned task to client site-2: name=train, id=a8fd8b19-8ab7-45a2-97ae-8357d78e491a
2022-12-05 16:05:48,116 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather, peer=site-2, peer_run=simulate_job, task_name=train, task_id=a8fd8b19-8ab7-45a2-97ae-8357d78e491a]: sent task assignment to client
-------------------------------------------------- initialize: site-1 --------------------------------------------------

            load data from /workspace/src/data: site-1_train.csv and site-1_val.csv
            size of the data: 
            site-1_train.csv: 15346
            site-1_val.csv: 1919
            
2022-12-05 16:05:48,310 - ClientRunner - INFO - [identity=site-1, run=simulate_job]: client runner started
2022-12-05 16:05:48,310 - ClientTaskWorker - INFO - Initialize ClientRunner for client: site-1
2022-12-05 16:05:48,915 - SimulatorServer - INFO - GetTask: Return task: train to client: site-2 (0daa4e44-d9ff-48ae-8b54-d176e90d5969) 
2022-12-05 16:05:49,321 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather, peer=site-1, peer_run=simulate_job, task_name=train, task_id=3a3577ef-b2b1-439b-a163-54646f5152cb]: assigned task to client site-1: name=train, id=3a3577ef-b2b1-439b-a163-54646f5152cb
2022-12-05 16:05:49,323 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather, peer=site-1, peer_run=simulate_job, task_name=train, task_id=3a3577ef-b2b1-439b-a163-54646f5152cb]: sent task assignment to client
2022-12-05 16:05:50,165 - SimulatorServer - INFO - GetTask: Return task: train to client: site-1 (ef0b6c2d-8bfb-4e93-ba94-ee33138fbb2f) 
2022-12-05 16:06:11,458 - Communicator - INFO - Received from simulator_server server  (430981217 Bytes). getTask time: 23.351224899291992 seconds
2022-12-05 16:06:11,467 - FederatedClient - INFO - pull_task completed. Task name:train Status:True 
2022-12-05 16:06:12,003 - ClientRunner - INFO - [identity=site-2, run=simulate_job, peer=simulator_server, peer_run=simulate_job]: got task assignment: name=train, id=a8fd8b19-8ab7-45a2-97ae-8357d78e491a
2022-12-05 16:06:12,003 - ClientRunner - INFO - [identity=site-2, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=a8fd8b19-8ab7-45a2-97ae-8357d78e491a]: invoking task executor <class 'nvflare.app_common.executors.learner_executor.LearnerExecutor'>
2022-12-05 16:06:12,003 - LearnerExecutor - INFO - [identity=site-2, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=a8fd8b19-8ab7-45a2-97ae-8357d78e491a]: Client trainer got task: train
2022-12-05 16:06:12,764 - Communicator - INFO - Received from simulator_server server  (430981217 Bytes). getTask time: 24.451159477233887 seconds
2022-12-05 16:06:12,790 - FederatedClient - INFO - pull_task completed. Task name:train Status:True 
2022-12-05 16:06:13,301 - ClientRunner - INFO - [identity=site-1, run=simulate_job, peer=simulator_server, peer_run=simulate_job]: got task assignment: name=train, id=3a3577ef-b2b1-439b-a163-54646f5152cb
2022-12-05 16:06:13,302 - ClientRunner - INFO - [identity=site-1, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=3a3577ef-b2b1-439b-a163-54646f5152cb]: invoking task executor <class 'nvflare.app_common.executors.learner_executor.LearnerExecutor'>
2022-12-05 16:06:13,302 - LearnerExecutor - INFO - [identity=site-1, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=3a3577ef-b2b1-439b-a163-54646f5152cb]: Client trainer got task: train
-------------------------------------------------- validate: site-2 --------------------------------------------------
-------------------------------------------------- local validate: site-2 --------------------------------------------------
2022-12-05 16:06:34,611 - PTLearner - INFO - [identity=site-2, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=a8fd8b19-8ab7-45a2-97ae-8357d78e491a]: Accuracy when validating site-2's model on site-2s data: 0.13736001583190835
-------------------------------------------------- validate: site-1 --------------------------------------------------
-------------------------------------------------- local validate: site-1 --------------------------------------------------
2022-12-05 16:06:35,461 - PTLearner - INFO - [identity=site-1, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=3a3577ef-b2b1-439b-a163-54646f5152cb]: Accuracy when validating site-1's model on site-1s data: 0.13391050901167775
  2022-12-05 16:13:30,100 - SimulatorServer - INFO - getting AuxCommunicate request
-------------------------------------------------- train start: site-1 --------------------------------------------------
-------------------------------------------------- local training: site-1 --------------------------------------------------
-------------------------------------------------- local validate: site-1 --------------------------------------------------
-------------------------------------------------- save local model: site-1 --------------------------------------------------
training 0/1: 
              precision    recall  f1-score   support

         art       0.00      0.00      0.00       222
         eve       0.00      0.00      0.00        96
         geo       0.63      0.52      0.57     14594
         gpe       0.76      0.57      0.65      5584
         nat       0.00      0.00      0.00       116
         org       0.46      0.33      0.39      8377
         per       0.47      0.45      0.46      7230
         tim       0.63      0.40      0.49      6802

   micro avg       0.58      0.45      0.51     43021
   macro avg       0.37      0.28      0.32     43021
weighted avg       0.58      0.45      0.51     43021

F1-score: 0.900724964124405
val 0/1: 
              precision    recall  f1-score   support

         art       0.00      0.00      0.00        19
         eve       0.00      0.00      0.00        16
         geo       0.73      0.69      0.71      1819
         gpe       0.88      0.74      0.80       731
         nat       0.00      0.00      0.00         6
         org       0.55      0.49      0.52       991
         per       0.66      0.67      0.66       907
         tim       0.71      0.57      0.63       854

   micro avg       0.70      0.63      0.66      5343
   macro avg       0.44      0.39      0.42      5343
weighted avg       0.70      0.63      0.66      5343

F1-score: 0.9338633958907049
2022-12-05 16:13:30,439 - PTLearner - INFO - [identity=site-1, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=38d2eb60-1b4b-4a50-8199-34af21fa6aa2]: train:
              precision    recall  f1-score   support

         art       0.00      0.00      0.00       222
         eve       0.00      0.00      0.00        96
         geo       0.63      0.52      0.57     14594
         gpe       0.76      0.57      0.65      5584
         nat       0.00      0.00      0.00       116
         org       0.46      0.33      0.39      8377
         per       0.47      0.45      0.46      7230
         tim       0.63      0.40      0.49      6802

   micro avg       0.58      0.45      0.51     43021
   macro avg       0.37      0.28      0.32     43021
weighted avg       0.58      0.45      0.51     43021

==========================================================
val:
              precision    recall  f1-score   support

         art       0.00      0.00      0.00        19
         eve       0.00      0.00      0.00        16
         geo       0.73      0.69      0.71      1819
         gpe       0.88      0.74      0.80       731
         nat       0.00      0.00      0.00         6
         org       0.55      0.49      0.52       991
         per       0.66      0.67      0.66       907
         tim       0.71      0.57      0.63       854

   micro avg       0.70      0.63      0.66      5343
   macro avg       0.44      0.39      0.42      5343
weighted avg       0.70      0.63      0.66      5343

-------------------------------------------------- save local model: site-1 --------------------------------------------------
2022-12-05 16:13:31,106 - ClientRunner - INFO - [identity=site-1, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=38d2eb60-1b4b-4a50-8199-34af21fa6aa2]: finished processing task
2022-12-05 16:13:31,108 - FederatedClient - INFO - Starting to push execute result.
2022-12-05 16:13:31,919 - Communicator - INFO - Send submitUpdate to simulator_server server
-------------------------------------------------- train start: site-2 --------------------------------------------------
-------------------------------------------------- local training: site-2 --------------------------------------------------
-------------------------------------------------- local validate: site-2 --------------------------------------------------
-------------------------------------------------- save local model: site-2 --------------------------------------------------
training 0/1: 
              precision    recall  f1-score   support

         art       0.00      0.00      0.00       176
         eve       0.00      0.00      0.00       117
         geo       0.63      0.53      0.58     14724
         gpe       0.78      0.57      0.66      5503
         nat       0.00      0.00      0.00        95
         org       0.45      0.34      0.39      8238
         per       0.46      0.45      0.45      6998
         tim       0.64      0.42      0.50      6773

   micro avg       0.58      0.46      0.51     42624
   macro avg       0.37      0.29      0.32     42624
weighted avg       0.58      0.46      0.51     42624

F1-score: 0.9041271802937989
val 0/1: 
              precision    recall  f1-score   support

         art       0.00      0.00      0.00        45
         eve       0.00      0.00      0.00        13
         geo       0.69      0.69      0.69      1773
         gpe       0.84      0.71      0.77       640
         nat       0.00      0.00      0.00        12
         org       0.53      0.51      0.52      1045
         per       0.62      0.55      0.58       940
         tim       0.77      0.56      0.64       859

   micro avg       0.67      0.60      0.63      5327
   macro avg       0.43      0.38      0.40      5327
weighted avg       0.67      0.60      0.63      5327

F1-score: 0.9309179590773589
2022-12-05 16:13:33,616 - PTLearner - INFO - [identity=site-2, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=233f3f5d-8075-4e85-984a-ca7470fdaa30]: train:
              precision    recall  f1-score   support

         art       0.00      0.00      0.00       176
         eve       0.00      0.00      0.00       117
         geo       0.63      0.53      0.58     14724
         gpe       0.78      0.57      0.66      5503
         nat       0.00      0.00      0.00        95
         org       0.45      0.34      0.39      8238
         per       0.46      0.45      0.45      6998
         tim       0.64      0.42      0.50      6773

   micro avg       0.58      0.46      0.51     42624
   macro avg       0.37      0.29      0.32     42624
weighted avg       0.58      0.46      0.51     42624

==========================================================
val:
              precision    recall  f1-score   support

         art       0.00      0.00      0.00        45
         eve       0.00      0.00      0.00        13
         geo       0.69      0.69      0.69      1773
         gpe       0.84      0.71      0.77       640
         nat       0.00      0.00      0.00        12
         org       0.53      0.51      0.52      1045
         per       0.62      0.55      0.58       940
         tim       0.77      0.56      0.64       859

   micro avg       0.67      0.60      0.63      5327
   macro avg       0.43      0.38      0.40      5327
weighted avg       0.67      0.60      0.63      5327

2022-12-05 16:13:33,795 - SimulatorServer - INFO - getting AuxCommunicate request
-------------------------------------------------- save local model: site-2 --------------------------------------------------
2022-12-05 16:13:34,484 - ClientRunner - INFO - [identity=site-2, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=233f3f5d-8075-4e85-984a-ca7470fdaa30]: finished processing task
2022-12-05 16:13:34,486 - FederatedClient - INFO - Starting to push execute result.
2022-12-05 16:13:35,273 - Communicator - INFO - Send submitUpdate to simulator_server server
2022-12-05 16:13:54,820 - SimulatorServer - INFO - received update from simulator_server_site-1_0 (430981542 Bytes, 1670256834 seconds)
2022-12-05 16:13:54,820 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather, peer=site-1, peer_run=simulate_job]: got result from client site-1 for task: name=train, id=38d2eb60-1b4b-4a50-8199-34af21fa6aa2
2022-12-05 16:13:54,821 - ScatterAndGather - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather, peer=site-1, peer_run=simulate_job, peer_rc=OK, task_name=train, task_id=38d2eb60-1b4b-4a50-8199-34af21fa6aa2]: invoking result_received_cb ...
2022-12-05 16:13:54,937 - ScatterAndGather - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather, peer=site-1, peer_run=simulate_job, peer_rc=OK, task_name=train, task_id=38d2eb60-1b4b-4a50-8199-34af21fa6aa2]: Contribution from site-1 ACCEPTED by the aggregator.
2022-12-05 16:13:54,937 - ServerRunner - INFO - [identity=simulator_server, run=simulate_job, wf=scatter_and_gather, peer=site-1, peer_run=simulate_job, peer_rc=OK, task_name=train, task_id=38d2eb60-1b4b-4a50-8199-34af21fa6aa2]: finished processing client result by scatter_and_gather
2022-12-05 16:13:54,967 - Communicator - INFO - Received comments: simulator_server Received from site-1 (430981542 Bytes, 1670256834 seconds). SubmitUpdate time: 23.04848551750183 seconds
2022-12-05 16:13:55,021 - ClientRunner - INFO - [identity=site-1, run=simulate_job, peer=simulator_server, peer_run=simulate_job, task_name=train, task_id=38d2eb60-1b4b-4a50-8199-34af21fa6aa2]: result sent to server for task: name=train, id=38d2eb60-1b4b-4a50-8199-34af21fa6aa2
2022-12-05 16:13:55,022 - ClientTaskWorker - INFO - Finished one task run for client: site-1
